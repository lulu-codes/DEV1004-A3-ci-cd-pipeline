# REUSABLE WORKFLOW: Deploy to Render
# PURPOSE: Triggers Render to pull and deploy the latest production Docker image and deploy via webhook.
# Then verifies the deployment is live with a health check
# CALLED BY: cd_production.yml only after CI Main Pipeline (tests + build) successfully completes

name: Deploy to Render

on:
  workflow_call:
    secrets:
      RENDER_DEPLOY_HOOK_URL:
        description: "Render deploy hook URL"
        required: true

  # Allow manual triggering to test deployment independently
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Render
    runs-on: ubuntu-latest

    steps:
      # Send POST request to Render deploy webhook
      # This tells Render to pull the latest Docker image from Docker Hub and redeploy the service
      - name: Trigger deployment
        run: curl --silent --fail -X POST "${{ secrets.RENDER_DEPLOY_HOOK_URL }}"